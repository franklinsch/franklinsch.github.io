<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>A scrolling animation for Tab Bar Controllers (iOS)</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Sans+Pro:300,300i,600">
  <link rel="stylesheet" href="/style.css">
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-71719858-1', 'auto');
  ga('send', 'pageview');
</script>

</head>
<body>
  <div class="container">
    <header class="masthead">
  <h1 class="masthead-title--small">
    <a href="/">Franklin Schrans</a>
  </h1>
</header>
<div class="content post">
  <h1 class="post-title">A scrolling animation for Tab Bar Controllers (iOS)</h1>
  <div class="post-date">
    <time>25 Dec 2015</time>
  </div>
  <p>Here’s a simple Friday (Christmas) morning project I just finished: animating the transition between View Controllers in a TabBarController. <a href="https://github.com/franklinsch/iOSScrollingTabBarAnimation">GitHub</a></p>

<p><img src="https://github.com/franklinsch/iOSScrollingTabBarAnimation/blob/master/demo.gif?raw=true" alt="iOSScrollingTabBarAnimation" /></p>

<h3 id="what-it-takes">What it takes</h3>

<ul>
  <li>Subclass <code class="highlighter-rouge">UITabBarControllerDelegate</code></li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">ScrollingTabBarControllerDelegate</span><span class="p">:</span> <span class="kt">NSObject</span><span class="p">,</span> <span class="kt">UITabBarControllerDelegate</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">tabBarController</span><span class="p">(</span><span class="nv">tabBarController</span><span class="p">:</span> <span class="kt">UITabBarController</span><span class="p">,</span> <span class="n">animationControllerForTransitionFromViewController</span> <span class="nv">fromVC</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">,</span> <span class="n">toViewController</span> <span class="nv">toVC</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UIViewControllerAnimatedTransitioning</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kt">ScrollingTransitionAnimator</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<ul>
  <li>Return an instance of a class that adopts <code class="highlighter-rouge">UIViewControllerAnimatedTransitioning</code>, which you need to create</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">ScrollingTransitionAnimator</span><span class="p">:</span> <span class="kt">NSObject</span><span class="p">,</span> <span class="kt">UIViewControllerAnimatedTransitioning</span> <span class="p">{</span>
</code></pre>
</div>

<ul>
  <li>Implement <code class="highlighter-rouge">transitionDuration(transitionContext:)</code></li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">transitionDuration</span><span class="p">(</span><span class="nv">transitionContext</span><span class="p">:</span> <span class="kt">UIViewControllerContextTransitioning</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">NSTimeInterval</span> <span class="p">{</span>
  <span class="k">return</span> <span class="mf">0.4</span>
<span class="p">}</span>

</code></pre>
</div>

<ul>
  <li>Implement <code class="highlighter-rouge">animateTransition(transitionContext:)</code></li>
</ul>

<p>We would like something like:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">animateTransition</span><span class="p">(</span><span class="nv">transitionContext</span><span class="p">:</span> <span class="kt">UIViewControllerContextTransitioning</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">self</span><span class="o">.</span><span class="n">transitionContext</span> <span class="o">=</span> <span class="n">transitionContext</span>

    <span class="k">let</span> <span class="nv">containerView</span> <span class="o">=</span> <span class="n">transitionContext</span><span class="o">.</span><span class="nf">containerView</span><span class="p">()</span>
    <span class="k">let</span> <span class="nv">fromViewController</span> <span class="o">=</span> <span class="n">transitionContext</span><span class="o">.</span><span class="nf">viewControllerForKey</span><span class="p">(</span><span class="kt">UITransitionContextFromViewControllerKey</span><span class="p">)</span>
    <span class="k">let</span> <span class="nv">toViewController</span> <span class="o">=</span> <span class="n">transitionContext</span><span class="o">.</span><span class="nf">viewControllerForKey</span><span class="p">(</span><span class="kt">UITransitionContextToViewControllerKey</span><span class="p">)</span>

    <span class="n">containerView</span><span class="p">?</span><span class="o">.</span><span class="nf">addSubview</span><span class="p">(</span><span class="n">toViewController</span><span class="o">!.</span><span class="n">view</span><span class="p">)</span>

    <span class="k">var</span> <span class="nv">viewWidth</span> <span class="o">=</span> <span class="kt">CGRectGetWidth</span><span class="p">(</span><span class="n">toViewController</span><span class="o">!.</span><span class="n">view</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">tabBarController</span><span class="o">.</span><span class="n">selectedIndex</span> <span class="o">&lt;</span> <span class="n">lastIndex</span> <span class="p">{</span>
      <span class="n">viewWidth</span> <span class="o">=</span> <span class="o">-</span><span class="n">viewWidth</span>
    <span class="p">}</span>

  <span class="n">toViewController</span><span class="o">!.</span><span class="n">view</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="kt">CGAffineTransformMakeTranslation</span><span class="p">(</span><span class="n">viewWidth</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="kt">UIView</span><span class="o">.</span><span class="nf">animateWithDuration</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="nf">transitionDuration</span><span class="p">((</span><span class="k">self</span><span class="o">.</span><span class="n">transitionContext</span><span class="p">)),</span> <span class="nv">delay</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="nv">usingSpringWithDamping</span><span class="p">:</span> <span class="mf">1.2</span><span class="p">,</span> <span class="nv">initialSpringVelocity</span><span class="p">:</span> <span class="mf">2.5</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="o">.</span><span class="kt">TransitionNone</span><span class="p">,</span> <span class="nv">animations</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">toViewController</span><span class="o">!.</span><span class="n">view</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="kt">CGAffineTransformIdentity</span>
        <span class="n">fromViewController</span><span class="o">!.</span><span class="n">view</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="kt">CGAffineTransformMakeTranslation</span><span class="p">(</span><span class="o">-</span><span class="n">viewWidth</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">},</span> <span class="nv">completion</span><span class="p">:</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span>
        <span class="k">self</span><span class="o">.</span><span class="n">transitionContext</span><span class="p">?</span><span class="o">.</span><span class="nf">completeTransition</span><span class="p">(</span><span class="o">!</span><span class="k">self</span><span class="o">.</span><span class="n">transitionContext</span><span class="o">!.</span><span class="nf">transitionWasCancelled</span><span class="p">())</span>
        <span class="n">fromViewController</span><span class="o">!.</span><span class="n">view</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="kt">CGAffineTransformIdentity</span>
        <span class="p">})</span>
<span class="p">}</span>
</code></pre>
</div>

<p>But how to we get <code class="highlighter-rouge">tabBarController.selectedIndex</code> and <code class="highlighter-rouge">lastIndex</code>? We need them to know in which direction the scrolling should occur.</p>

<p>Let’s pass them in <code class="highlighter-rouge">ScrollingTransitionAnimator</code>’s constructor:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nf">init</span><span class="p">(</span><span class="nv">tabBarController</span><span class="p">:</span> <span class="kt">UITabBarController</span><span class="p">,</span> <span class="nv">lastIndex</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">self</span><span class="o">.</span><span class="n">tabBarController</span> <span class="o">=</span> <span class="n">tabBarController</span>
  <span class="k">self</span><span class="o">.</span><span class="n">lastIndex</span> <span class="o">=</span> <span class="n">lastIndex</span>
<span class="p">}</span>
</code></pre>
</div>

<p>And update the <code class="highlighter-rouge">delegate</code> accordingly:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">ScrollingTabBarControllerDelegate</span><span class="p">:</span> <span class="kt">NSObject</span><span class="p">,</span> <span class="kt">UITabBarControllerDelegate</span> <span class="p">{</span>
  <span class="kd">func</span> <span class="nf">tabBarController</span><span class="p">(</span><span class="nv">tabBarController</span><span class="p">:</span> <span class="kt">UITabBarController</span><span class="p">,</span> <span class="n">animationControllerForTransitionFromViewController</span> <span class="nv">fromVC</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">,</span> <span class="n">toViewController</span> <span class="nv">toVC</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UIViewControllerAnimatedTransitioning</span><span class="p">?</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kt">ScrollingTransitionAnimator</span><span class="p">(</span><span class="nv">tabBarController</span><span class="p">:</span> <span class="n">tabBarController</span><span class="p">,</span> <span class="nv">lastIndex</span><span class="p">:</span> <span class="n">tabBarController</span><span class="o">.</span><span class="n">selectedIndex</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<h3 id="wrapping-it-up">Wrapping it up</h3>

<p>Tadaa!<br />
Now all we need to do is set our <code class="highlighter-rouge">UITabBarController</code>’s <code class="highlighter-rouge">delegate</code> to an instance of <code class="highlighter-rouge">ScrollingTabBarControllerDelegate</code> and we’re done!</p>

<p>Here’s the full code:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>
<span class="kd">class</span> <span class="kt">ScrollingTabBarControllerDelegate</span><span class="p">:</span> <span class="kt">NSObject</span><span class="p">,</span> <span class="kt">UITabBarControllerDelegate</span> <span class="p">{</span>
  <span class="kd">func</span> <span class="nf">tabBarController</span><span class="p">(</span><span class="nv">tabBarController</span><span class="p">:</span> <span class="kt">UITabBarController</span><span class="p">,</span> <span class="n">animationControllerForTransitionFromViewController</span> <span class="nv">fromVC</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">,</span> <span class="n">toViewController</span> <span class="nv">toVC</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UIViewControllerAnimatedTransitioning</span><span class="p">?</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kt">ScrollingTransitionAnimator</span><span class="p">(</span><span class="nv">tabBarController</span><span class="p">:</span> <span class="n">tabBarController</span><span class="p">,</span> <span class="nv">lastIndex</span><span class="p">:</span> <span class="n">tabBarController</span><span class="o">.</span><span class="n">selectedIndex</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">ScrollingTransitionAnimator</span><span class="p">:</span> <span class="kt">NSObject</span><span class="p">,</span> <span class="kt">UIViewControllerAnimatedTransitioning</span> <span class="p">{</span>
  <span class="k">weak</span> <span class="k">var</span> <span class="nv">transitionContext</span><span class="p">:</span> <span class="kt">UIViewControllerContextTransitioning</span><span class="p">?</span>
    <span class="k">var</span> <span class="nv">tabBarController</span><span class="p">:</span> <span class="kt">UITabBarController</span><span class="o">!</span>
    <span class="k">var</span> <span class="nv">lastIndex</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="kd">func</span> <span class="nf">transitionDuration</span><span class="p">(</span><span class="nv">transitionContext</span><span class="p">:</span> <span class="kt">UIViewControllerContextTransitioning</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">NSTimeInterval</span> <span class="p">{</span>
      <span class="k">return</span> <span class="mf">0.4</span>
    <span class="p">}</span>

  <span class="nf">init</span><span class="p">(</span><span class="nv">tabBarController</span><span class="p">:</span> <span class="kt">UITabBarController</span><span class="p">,</span> <span class="nv">lastIndex</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">self</span><span class="o">.</span><span class="n">tabBarController</span> <span class="o">=</span> <span class="n">tabBarController</span>
      <span class="k">self</span><span class="o">.</span><span class="n">lastIndex</span> <span class="o">=</span> <span class="n">lastIndex</span>
  <span class="p">}</span>

  <span class="kd">func</span> <span class="nf">animateTransition</span><span class="p">(</span><span class="nv">transitionContext</span><span class="p">:</span> <span class="kt">UIViewControllerContextTransitioning</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">self</span><span class="o">.</span><span class="n">transitionContext</span> <span class="o">=</span> <span class="n">transitionContext</span>

      <span class="k">let</span> <span class="nv">containerView</span> <span class="o">=</span> <span class="n">transitionContext</span><span class="o">.</span><span class="nf">containerView</span><span class="p">()</span>
      <span class="k">let</span> <span class="nv">fromViewController</span> <span class="o">=</span> <span class="n">transitionContext</span><span class="o">.</span><span class="nf">viewControllerForKey</span><span class="p">(</span><span class="kt">UITransitionContextFromViewControllerKey</span><span class="p">)</span>
      <span class="k">let</span> <span class="nv">toViewController</span> <span class="o">=</span> <span class="n">transitionContext</span><span class="o">.</span><span class="nf">viewControllerForKey</span><span class="p">(</span><span class="kt">UITransitionContextToViewControllerKey</span><span class="p">)</span>

      <span class="n">containerView</span><span class="p">?</span><span class="o">.</span><span class="nf">addSubview</span><span class="p">(</span><span class="n">toViewController</span><span class="o">!.</span><span class="n">view</span><span class="p">)</span>

      <span class="k">var</span> <span class="nv">viewWidth</span> <span class="o">=</span> <span class="kt">CGRectGetWidth</span><span class="p">(</span><span class="n">toViewController</span><span class="o">!.</span><span class="n">view</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>

      <span class="k">if</span> <span class="n">tabBarController</span><span class="o">.</span><span class="n">selectedIndex</span> <span class="o">&lt;</span> <span class="n">lastIndex</span> <span class="p">{</span>
        <span class="n">viewWidth</span> <span class="o">=</span> <span class="o">-</span><span class="n">viewWidth</span>
      <span class="p">}</span>

    <span class="n">toViewController</span><span class="o">!.</span><span class="n">view</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="kt">CGAffineTransformMakeTranslation</span><span class="p">(</span><span class="n">viewWidth</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

      <span class="kt">UIView</span><span class="o">.</span><span class="nf">animateWithDuration</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="nf">transitionDuration</span><span class="p">((</span><span class="k">self</span><span class="o">.</span><span class="n">transitionContext</span><span class="p">)),</span> <span class="nv">delay</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="nv">usingSpringWithDamping</span><span class="p">:</span> <span class="mf">1.2</span><span class="p">,</span> <span class="nv">initialSpringVelocity</span><span class="p">:</span> <span class="mf">2.5</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="o">.</span><span class="kt">TransitionNone</span><span class="p">,</span> <span class="nv">animations</span><span class="p">:</span> <span class="p">{</span>
          <span class="n">toViewController</span><span class="o">!.</span><span class="n">view</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="kt">CGAffineTransformIdentity</span>
          <span class="n">fromViewController</span><span class="o">!.</span><span class="n">view</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="kt">CGAffineTransformMakeTranslation</span><span class="p">(</span><span class="o">-</span><span class="n">viewWidth</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
          <span class="p">},</span> <span class="nv">completion</span><span class="p">:</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span>
          <span class="k">self</span><span class="o">.</span><span class="n">transitionContext</span><span class="p">?</span><span class="o">.</span><span class="nf">completeTransition</span><span class="p">(</span><span class="o">!</span><span class="k">self</span><span class="o">.</span><span class="n">transitionContext</span><span class="o">!.</span><span class="nf">transitionWasCancelled</span><span class="p">())</span>
          <span class="n">fromViewController</span><span class="o">!.</span><span class="n">view</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="kt">CGAffineTransformIdentity</span>
          <span class="p">})</span>
  <span class="p">}</span>
<span class="p">}</span>

</code></pre>
</div>

</div>

  </div>
</body>
</html>
